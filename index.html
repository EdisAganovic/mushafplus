<!DOCTYPE html>
<html lang="bs" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mushaf Plus</title>
    <!-- PWA Settings -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#064e3b">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">

    <!-- Global App Configuration -->
    <script>
        // IMPORTANT: Change this version to force cache refresh for all users
        const APP_VERSION = "0.0.11"; 
    </script>

    <!-- UI Styles and Favicon (Dynamic versioning) -->
    <script>
        document.write(`<link rel="icon" type="image/png" href="favicon.png?v=${APP_VERSION}">`);
        document.write(`<link rel="stylesheet" href="css/tailwind-output.css?v=${APP_VERSION}">`);
        document.write(`<link rel="stylesheet" href="css/styles.css?v=${APP_VERSION}">`);
    </script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Outfit:wght@300;400;600&display=swap"
        rel="stylesheet">

    <!-- Ionicons -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>

<body class="bg-slate-950 text-slate-50 font-outfit h-screen overflow-hidden flex flex-col">

    <!-- Header -->
    <header class="bg-slate-900 border-b-2 border-emerald-800 shadow-lg z-10 shrink-0 w-full">
        <!-- Desktop/Tablet Header row -->
        <div class="max-w-[1400px] mx-auto flex flex-col md:flex-row w-full items-center">

            <!-- Mimic Main Content Area Structure -->
            <div class="hidden md:flex flex-1 px-3 sm:px-6 py-[0.5rem]  w-full justify-center items-center">
                <div class="w-full max-w-4xl flex items-center justify-between">
                    <!-- Left group: title -->
                    <div class="hidden md:flex items-center gap-[0.5rem] shrink-0">
                        <span class="text-[1.5rem] hidden md:inline">üìñ</span>
                        <h1 id="app-title"
                            class="text-[1.125rem] font-bold bg-gradient-to-r from-emerald-400 to-emerald-600 bg-clip-text text-transparent whitespace-nowrap">
                            Mushaf Plus
                        </h1>
                    </div>

                    <!-- Desktop Search -->
                    <div class="relative group z-50 hidden sm:flex shrink-0 ml-4">
                        <div class="relative w-full max-w-[200px] xl:max-w-[300px]">
                            <input type="text" id="search-input" data-i18n-placeholder="searchPlaceholder"
                                placeholder="Pretra≈æi tekst ili ajet (2:255)..."
                                class="bg-slate-950 border border-slate-700 text-slate-100 h-[2.5rem] pl-[2.25rem] pr-[1rem] rounded-lg outline-none focus:border-emerald-500 transition-all w-full text-[0.875rem] placeholder:text-slate-600 focus:ring-2 focus:ring-emerald-500/20">
                            <ion-icon name="search-outline"
                                class="absolute left-[0.75rem] top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-emerald-500 transition-colors"></ion-icon>
                        </div>
                        <div id="search-results-container"
                            class="absolute top-[3rem] left-0 right-0 w-[400px] max-h-[24rem] bg-slate-900 border border-slate-700 rounded-xl shadow-2xl overflow-y-auto hidden flex-col custom-scrollbar z-50">
                            <div id="search-results-list" class="flex flex-col"></div>
                            <div id="search-empty-state" class="p-[1rem] text-center text-[0.875rem] text-slate-500 hidden"
                                data-i18n="noResults">
                                Nema rezultata
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mimic Sidebar Structure -->
            <div class="hidden md:flex items-center justify-between md:justify-end px-3 sm:px-6 pt-3 md:mt-0 sm:py-[0.75rem] w-full md:w-80 shrink-0 gap-[0.5rem]">
                <select id="surah-select"
                    class="bg-slate-950 border border-slate-700 text-slate-100 h-[2.5rem] px-[0.5rem] rounded-lg outline-none focus:border-emerald-500 transition-colors cursor-pointer text-[0.875rem] min-w-0 w-0 flex-grow sm:w-auto sm:flex-grow-0 overflow-hidden text-ellipsis">
                    <option value="" disabled selected class="bg-slate-900" data-i18n="selectSurah">Izaberi suru...
                    </option>
                </select>

                <div class="flex items-center gap-[0.5rem] shrink-0">
                    <button id="settings-toggle"
                        class="text-slate-300 hover:text-emerald-500 bg-slate-950 border border-slate-700 hover:bg-slate-800 transition-colors w-[2.5rem] h-[2.5rem] text-[1.25rem] rounded-lg flex items-center justify-center shrink-0">
                        <ion-icon name="options-outline"></ion-icon>
                    </button>
                    <button id="mobile-grid-toggle"
                        class="md:hidden text-slate-100 hover:text-emerald-500 transition-colors w-[2.5rem] h-[2.5rem] text-[1.25rem] rounded-lg hover:bg-slate-800 bg-slate-950 border border-slate-700 flex items-center justify-center shrink-0">
                        <ion-icon name="menu-outline"></ion-icon>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile search row -->
        <div class="relative group z-40 w-full hidden px-[0.75rem] mt-1 pb-3">
            <div class="relative w-full">
                <input type="text" id="search-input-mobile" data-i18n-placeholder="searchPlaceholder"
                    placeholder="Pretra≈æi tekst ili ajet (2:255)..."
                    class="bg-slate-950 border border-slate-700 text-slate-100 h-[2.5rem] pl-[2.25rem] pr-[1rem] rounded-lg outline-none focus:border-emerald-500 transition-all w-full text-[0.875rem] placeholder:text-slate-600 focus:ring-2 focus:ring-emerald-500/20">
                <ion-icon name="search-outline"
                    class="absolute left-[0.75rem] top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-emerald-500 transition-colors"></ion-icon>
            </div>
            <div id="search-results-container-mobile"
                class="absolute top-[3rem] left-[0.75rem] right-[0.75rem] max-h-[24rem] bg-slate-900 border border-slate-700 rounded-xl shadow-2xl overflow-y-auto hidden flex-col custom-scrollbar z-50">
                <div id="search-results-list-mobile" class="flex flex-col"></div>
                <div id="search-empty-state-mobile" class="p-[1rem] text-center text-[0.875rem] text-slate-500 hidden"
                    data-i18n="noResults">
                    Nema rezultata
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div id="app-container" class="flex-1 flex flex-col md:flex-row overflow-hidden max-w-[1400px] mx-auto w-full">

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col p-3 sm:p-6 overflow-y-auto items-center min-h-0">

            <!-- Ayah Card -->
            <div
                class="w-full max-w-4xl bg-slate-900 border border-slate-800 rounded-2xl p-4 sm:p-8 shadow-2xl flex flex-col items-center min-h-[250px] sm:min-h-[400px] justify-center relative shrink-0">

                <!-- Navigation Hint -->
                <div class="w-full text-center mb-1">
                    <div id="current-surah-name" class="font-bold text-emerald-400 text-sm mb-1 uppercase tracking-widest leading-none"></div>
                </div>

                <!-- Navigation Badges -->
                <div class="w-full flex justify-center mt-1.5 pt-3 sm:mb-6 gap-1.5 flex-wrap">
                    <!-- Ayah Badge -->
                    <div class="text-[11px] sm:text-sm font-mono text-emerald-500 bg-emerald-500/10 px-3 py-1.5 rounded-full border border-emerald-500/20 flex items-center shadow-md">
                        <label for="ayah-input" data-i18n="ayahLabel" class="cursor-pointer mr-1 opacity-90">Ajet</label>
                        <input type="number" id="ayah-input" min="1" max="286" placeholder="0"
                            class="bg-transparent border-none text-emerald-400 font-bold w-9 text-center outline-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none">
                        <span class="opacity-90 ml-1">/ <span id="total-ayahs-num">0</span></span>
                    </div>

                    <!-- Juz Badge -->
                    <div class="text-[11px] sm:text-sm font-mono text-amber-500 bg-amber-500/10 px-3 py-1.5 rounded-full border border-amber-500/20 flex items-center gap-1 shadow-md">
                        <label for="juz-input" data-i18n="juzLabel" class="opacity-90 cursor-pointer">D≈æuz</label>
                        <input type="number" id="juz-input" min="1" max="30" placeholder="0"
                            class="bg-transparent border-none text-amber-400 font-bold w-5 text-center outline-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none">
                    </div>

                    <!-- Page Badge -->
                    <div class="text-[11px] sm:text-sm font-mono text-blue-400 bg-blue-500/10 px-3 py-1.5 rounded-full border border-blue-500/20 flex items-center gap-1 shadow-md">
                        <label for="page-input" data-i18n="pageLabel" class="opacity-90 cursor-pointer">Str.</label>
                        <input type="number" id="page-input" min="1" max="604" placeholder="0"
                            class="bg-transparent border-none text-blue-300 font-bold w-10 text-center outline-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none">
                    </div>
                </div>
                <div id="arabic-display"
                    class="font-quran quran-text text-[1.5rem] mt-4 sm:text-4xl md:text-5xl text-right w-full text-slate-100 selection:bg-emerald-800 transition-all duration-300">
                </div>

                <!-- Tajweed Legend -->
                <div id="tajweed-legend-container"
                    class="mt-4 sm:mt-6 sm:mb-3 w-full mb-4 max-w-2xl hidden flex-wrap gap-1.5 justify-center">
                    <div id="tajweed-legend" class="flex flex-wrap gap-1.5 justify-center w-full"></div>
                </div>
                <div id="translation-display"
                    class="text-sm sm:text-lg md:text-xl text-slate-400 text-left max-w-2xl w-full">
                </div>
                
                

                <!-- Actions & Navigation -->
                <div class="flex items-center gap-2 sm:gap-3 mt-6 sm:mt-8 w-full max-w-lg">
                    <button id="prev-btn"
                        class="flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-slate-800 hover:bg-slate-700 transition-all active:scale-95 shrink-0">
                        <ion-icon name="arrow-back-outline" class="text-lg sm:text-xl"></ion-icon>
                    </button>

                    <button id="record-btn"
                        class="flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-emerald-700 hover:bg-emerald-600 transition-all active:scale-95 shadow-lg shadow-emerald-900/20 relative overflow-hidden shrink-0">
                        <div id="mic-meter-container" class="absolute inset-0 bg-emerald-900/20 hidden">
                            <div id="mic-meter-bar" class="h-full bg-emerald-400/30 transition-all duration-75 w-0">
                            </div>
                        </div>
                        <ion-icon name="mic-outline" class="text-lg sm:text-xl relative z-10"></ion-icon>
                        <span id="record-text" class="hidden" data-i18n="record">Snimi</span>
                    </button>

                    <button id="valid-btn"
                        class="flex-1 flex items-center justify-center gap-1.5 sm:gap-2 py-2 sm:py-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition-all font-semibold active:scale-95 border-2 border-transparent text-xs sm:text-base">
                        <ion-icon name="checkmark-circle-outline" class="text-base sm:text-xl"></ion-icon>
                        <span data-i18n="valid">Taƒçno</span>
                    </button>

                    <button id="bookmark-btn"
                        class="flex-1 flex items-center justify-center gap-1.5 sm:gap-2 py-2 sm:py-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition-all font-semibold active:scale-95 border-2 border-transparent text-xs sm:text-base">
                        <ion-icon name="bookmark-outline" class="text-base sm:text-xl"></ion-icon>
                        <span data-i18n="bookmark">Oznaƒçi</span>
                    </button>

                    <button id="next-btn"
                        class="flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-slate-800 hover:bg-slate-700 transition-all active:scale-95 shrink-0">
                        <ion-icon name="arrow-forward-outline" class="text-lg sm:text-xl"></ion-icon>
                    </button>
                </div>

                <!-- Navigation Controls -->
                <div id="ayah-audio-container"
                    class="mt-6 sm:mt-8 hidden w-full max-w-lg flex flex-col items-center gap-2">
                    <div
                        class="flex items-center gap-2 sm:gap-4 w-full bg-slate-800/40 p-2 sm:p-3 rounded-2xl border border-slate-700/50 backdrop-blur-sm shadow-inner">
                        <button id="ayah-play-btn"
                            class="w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center rounded-full bg-emerald-600 text-white hover:bg-emerald-500 transition-all active:scale-90 shadow-lg shadow-emerald-900/40 group overflow-hidden shrink-0">
                            <ion-icon name="play" id="ayah-play-icon" class="text-xl ml-1"></ion-icon>
                            <ion-icon name="pause" id="ayah-pause-icon" class="text-xl hidden"></ion-icon>
                        </button>

                        <div class="flex-1 flex flex-col gap-1 pr-1 sm:pr-2">
                            <div
                                class="flex items-center justify-between text-[9px] sm:text-[10px] text-slate-500 uppercase tracking-widest font-bold">
                                <span id="reciter-name-label">Recitacija</span>
                                <span id="ayah-audio-time">0:00 / 0:00</span>
                            </div>
                            <div id="ayah-progress-bg"
                                class="h-1.5 sm:h-2 w-full bg-slate-700/50 rounded-full cursor-pointer relative overflow-hidden">
                                <div id="ayah-audio-progress" class="h-full bg-emerald-500 w-0 absolute top-0 left-0">
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center gap-1 sm:gap-2 ml-1 shrink-0">
                            <button id="ayah-speed-btn" data-i18n-title="playbackSpeed"
                                class="text-[9px] sm:text-[10px] font-bold text-slate-300 hover:text-emerald-400 bg-slate-900/80 rounded px-1.5 py-0.5 sm:px-2 sm:py-1 border border-slate-700 transition-colors w-8 sm:w-10 text-center"
                                title="Brzina">1x</button>
                            <button id="ayah-loop-btn" data-i18n-title="loopAyah"
                                class="w-7 h-7 sm:w-8 sm:h-8 flex items-center justify-center text-lg sm:text-xl text-slate-500 hover:text-emerald-400 transition-colors rounded-full hover:bg-slate-800"
                                title="Ponavljaj ajet">
                                <ion-icon name="repeat"></ion-icon>
                            </button>
                        </div>
                    </div>
                    <audio id="ayah-audio" class="hidden"></audio>
                </div>



                <!-- User Recording Player -->
                <div id="user-audio-container" class="mt-2 hidden w-full max-w-lg flex flex-col items-center gap-2">
                    <div
                        class="flex items-center gap-2 sm:gap-4 w-full bg-amber-500/10 p-2 sm:p-3 rounded-2xl border border-amber-500/20 backdrop-blur-sm shadow-inner">
                        <button id="user-play-btn"
                            class="w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center rounded-full bg-amber-500 text-slate-950 hover:bg-amber-400 transition-all active:scale-90 shadow-lg shadow-amber-900/40 group overflow-hidden shrink-0">
                            <ion-icon name="play" id="user-play-icon" class="text-xl ml-1"></ion-icon>
                            <ion-icon name="pause" id="user-pause-icon" class="text-xl hidden"></ion-icon>
                        </button>

                        <div class="flex-1 flex flex-col gap-1 pr-1 sm:pr-2">
                            <div
                                class="flex items-center justify-between text-[9px] sm:text-[10px] text-amber-500 uppercase tracking-widest font-bold">
                                <span data-i18n="yourRecording">Tvoj snimak</span>
                                <span id="user-audio-time">0:00 / 0:00</span>
                            </div>
                            <div id="user-progress-bg"
                                class="h-1.5 sm:h-2 w-full bg-amber-500/20 rounded-full cursor-pointer relative overflow-hidden">
                                <div id="user-audio-progress" class="h-full bg-amber-500 w-0 absolute top-0 left-0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Notes Section -->
                <div id="ayah-notes-container"
                    class="mt-4 sm:mt-6 w-full max-w-lg flex flex-col gap-2 opacity-60 hover:opacity-100 transition-opacity">
                    <div
                        class="flex items-center gap-2 text-[10px] text-slate-500 uppercase tracking-widest font-bold ml-1">
                        <ion-icon name="create-outline"></ion-icon>
                        <span data-i18n="notesTitle">Liƒçne bilje≈°ke</span>
                    </div>
                    <textarea id="ayah-notes" data-i18n-placeholder="notesPlaceholder"
                        placeholder="Dodaj podsjetnik (npr. 'Obrati pa≈ænju na ted≈ævid kod rijeƒçi X')..."
                        class="w-full bg-slate-950/50 border border-slate-800 rounded-xl p-3 text-sm text-slate-300 outline-none focus:border-amber-500/50 focus:ring-1 focus:ring-amber-500/20 transition-all resize-none h-16 sm:h-20 placeholder:text-slate-700"></textarea>
                </div>
            </div> <!-- Close Ayah Card -->


            <!-- Spacer to prevent mobile bottom nav from covering content -->
            <div class="h-40 sm:h-16 w-full shrink-0"></div>

        </main>

        <!-- Sidebar Overlay (Mobile) -->
        <div id="sidebar-overlay"
            class="fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-40 hidden opacity-0 transition-opacity duration-300 md:hidden">
        </div>

        <!-- Sidebar -->
        <aside id="sidebar"
            class="fixed inset-y-0 right-0 w-4/5 sm:w-80 bg-slate-900 border-l border-slate-800 p-6 flex flex-col shrink-0 overflow-y-auto z-50 transform translate-x-full transition-transform duration-300 md:relative md:translate-x-0 md:w-80 shadow-2xl md:shadow-none">

            <div class="flex justify-between items-center mb-6 md:hidden">
                <h2 class="text-lg font-bold text-slate-200" data-i18n="menu">Meni</h2>
                <button id="sidebar-close" class="text-3xl text-slate-400 hover:text-slate-200 transition-colors">
                    <ion-icon name="close-outline"></ion-icon>
                </button>
            </div>

            <!-- Hifz Mode Toggle -->
            <div class="mb-4 bg-rose-500/5 border border-rose-500/20 rounded-xl p-3">
                <div class="flex items-center justify-between gap-2">
                    <div class="flex flex-col flex-1">
                        <span class="text-xs font-bold text-rose-400 uppercase tracking-wider">Hifz Mod</span>
                        <span id="hifz-range-text" class="text-[10px] text-slate-500 line-clamp-1">Klikni na ajet za opseg</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer shrink-0">
                        <input type="checkbox" id="hifz-toggle" class="sr-only peer">
                        <div
                            class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-rose-500">
                        </div>
                    </label>
                </div>
            </div>

            <!-- Progress Section -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-semibold text-slate-400" data-i18n="surahProgress">Progres</span>
                    <span id="progress-percent" class="text-sm font-bold text-emerald-400">0 / 0</span>
                </div>
                <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                    <div id="progress-bar-fill"
                        class="bg-gradient-to-r from-emerald-600 to-emerald-400 h-full w-0 transition-all duration-700 ease-out">
                    </div>
                </div>
            </div>

            <h3 id="ayah-grid-title" class="text-slate-200 font-bold mb-2 flex items-center gap-2 text-sm">
                <ion-icon name="grid-outline"></ion-icon>
                <span data-i18n="ayahGrid">Ajeti</span>
            </h3>

            <!-- Grid Legend -->
            <div class="flex flex-wrap gap-3 mb-3 text-[10px] font-medium text-slate-400 px-1">
                <div class="flex items-center gap-1">
                    <div class="w-2.5 h-2.5 bg-emerald-500 rounded-sm"></div>
                    Trenutni ajet
                </div>
                <div class="flex items-center gap-1">
                    <div class="w-2 h-2 bg-rose-400 rounded-full"></div>
                    Hifz mod
                </div>
                <div class="flex items-center gap-1">
                    <div class="w-2 h-2 bg-amber-500 rounded-full"></div>
                    Poƒçetak d≈æuza
                </div>
                <div class="flex items-center gap-1">
                    <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                    Nova stranica
                </div>
            </div>

            <!-- Scrollable Ayah Grid -->
            <div class="flex-[3] overflow-y-auto custom-scrollbar mb-2 min-h-[120px] bg-slate-950/50 p-3 rounded-xl border border-slate-800/60">
                <div id="ayah-grid" class="grid grid-cols-5 content-start gap-2">
                    <!-- Ayah cells will be injected here -->
                </div>
            </div>

            <!-- Bookmarks Section -->
            <h3 class="text-slate-200 font-bold mb-4 flex items-center gap-2 border-t border-slate-800 pt-4">
                <ion-icon name="bookmarks-outline"></ion-icon>
                <span data-i18n="bookmarks">Oznaƒçeno</span>
            </h3>
            <div id="bookmarks-list"
                class="flex-[2] overflow-y-auto flex flex-col gap-2 pr-2 custom-scrollbar text-sm min-h-[150px]">
                <!-- Bookmarks will be injected here -->
                <div class="text-slate-500 italic text-center w-full mt-2 text-xs" data-i18n="noBookmarks">Jo≈° nema
                    oznaka</div>
            </div>

            <!-- Shortcuts Section -->
            <div class="mt-auto border-t border-slate-800 pt-4 hidden md:block">
                <h3 class="text-slate-200 font-bold mb-3 flex items-center gap-2 text-sm">
                    <ion-icon name="keypad-outline"></ion-icon>
                    <span data-i18n="keyboardShortcuts">Preƒçice na tastaturi</span>
                </h3>
                <div class="flex flex-col gap-2 text-[10px] text-slate-400 font-medium px-1 uppercase tracking-wider">
                    <div class="flex justify-between items-center">
                        <span data-i18n="navAyahs">Navigacija</span>
                        <div class="flex gap-1">
                            <kbd class="bg-slate-800 px-1.5 py-0.5 rounded border border-slate-700 shadow-sm">‚Üê</kbd>
                            <kbd class="bg-slate-800 px-1.5 py-0.5 rounded border border-slate-700 shadow-sm">‚Üí</kbd>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span data-i18n="recordStop">Snimi / Stop</span>
                        <kbd class="bg-slate-800 px-1.5 py-0.5 rounded border border-slate-700 shadow-sm">Space</kbd>
                    </div>
                    <div class="flex justify-between items-center">
                        <span data-i18n="markValid">Oznaƒçi taƒçno</span>
                        <kbd class="bg-slate-800 px-1.5 py-0.5 rounded border border-slate-700 shadow-sm">V</kbd>
                    </div>
                    <div class="flex justify-between items-center">
                        <span data-i18n="playRecitation">Pusti recitaciju</span>
                        <kbd class="bg-slate-800 px-1.5 py-0.5 rounded border border-slate-700 shadow-sm">P /
                            Enter</kbd>
                    </div>
                    <div class="flex justify-between items-center">
                        <span data-i18n="playRecording">Pusti snimak</span>
                        <kbd class="bg-slate-800 px-1.5 py-0.5 rounded border border-slate-700 shadow-sm">U</kbd>
                    </div>
                </div>
            </div>

        </aside>
    </div>

    <!-- Settings Overlay -->
    <div id="settings-overlay"
        class="fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-40 hidden opacity-0 transition-opacity duration-300">
    </div>

    <!-- Settings Drawer -->
    <aside id="settings-drawer"
        class="fixed inset-y-0 right-0 w-4/5 sm:w-80 bg-slate-900 border-l border-slate-800 p-6 flex flex-col shrink-0 overflow-y-auto z-50 transform translate-x-full transition-transform duration-300 shadow-2xl">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-lg font-bold text-slate-200 flex items-center gap-2">
                <ion-icon name="options-outline"></ion-icon>
                <span data-i18n="preferences">Postavke</span>
            </h2>
            <button id="settings-close" class="text-3xl text-slate-400 hover:text-slate-200 transition-colors">
                <ion-icon name="close-outline"></ion-icon>
            </button>
        </div>

        <!-- About & Version Buttons -->
        <div class="flex gap-2 mb-6">
            <button id="about-btn"
                class="flex-1 flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 text-slate-200 text-sm font-semibold py-2 rounded-lg transition-colors border border-slate-700">
                <ion-icon name="information-circle-outline"></ion-icon>
                <span>O aplikaciji</span>
            </button>
            <button id="version-btn"
                class="flex-1 flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 text-slate-200 text-sm font-semibold py-2 rounded-lg transition-colors border border-slate-700">
                <ion-icon name="git-branch-outline"></ion-icon>
                <span>Verzija</span>
            </button>
        </div>

        <!-- Settings Section -->
        <div class="mb-6">
            <div class="space-y-4">
                <div>
                    <div class="flex justify-between mb-1 translate-y-1">
                        <label class="text-[10px] text-slate-400 uppercase tracking-wider"
                            data-i18n="arabicFontSize">Veliƒçina arapskog fonta</label>
                        <span id="ar-size-val" class="text-xs font-bold text-emerald-400">140%</span>
                    </div>
                    <input type="range" id="ar-size-slider" min="80" max="600" step="10" value="140"
                        class="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-emerald-500">
                </div>

                <div>
                    <div class="flex justify-between mb-1 translate-y-1">
                        <label class="text-[10px] text-slate-400 uppercase tracking-wider"
                            data-i18n="translationFontSize">Veliƒçina prijevoda</label>
                        <span id="bs-size-val" class="text-xs font-bold text-emerald-400">100%</span>
                    </div>
                    <input type="range" id="bs-size-slider" min="80" max="250" step="10" value="100"
                        class="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-emerald-500">
                </div>

                <div>
                    <div class="flex justify-between mb-1 translate-y-1">
                        <label class="text-[10px] text-slate-400 uppercase tracking-wider"
                            data-i18n="arabicLineHeight">Razmak redova (arapski)</label>
                        <span id="ar-lh-val" class="text-xs font-bold text-emerald-400">1.6</span>
                    </div>
                    <input type="range" id="ar-lh-slider" min="1.0" max="4.0" step="0.1" value="1.6"
                        class="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-emerald-500">
                </div>

                <!-- Live Preview: Arabic -->
                <div class="mt-2 p-3 bg-slate-950/50 rounded-xl border border-slate-800">
                    <div class="text-[10px] text-slate-500 uppercase tracking-wider mb-2 font-bold">Prikaz ‚Äî Arapski
                    </div>
                    <div id="settings-preview-ar" class="font-quran text-slate-100 text-right" dir="rtl"
                        style="font-size:1.4rem; line-height:1.6">ŸÇŸèŸÑŸí ŸáŸèŸàŸé Ÿ±ŸÑŸÑŸéŸëŸáŸè ÿ£Ÿéÿ≠ŸéÿØŸå Ÿ° Ÿ±ŸÑŸÑŸéŸëŸáŸè Ÿ±ŸÑÿµŸéŸëŸÖŸéÿØŸè Ÿ¢</div>
                </div>

                <!-- Live Preview: Translation -->
                <div class="mt-2 p-3 bg-slate-950/50 rounded-xl border border-slate-800">
                    <div class="text-[10px] text-slate-500 uppercase tracking-wider mb-2 font-bold">Prikaz ‚Äî Prijevod
                    </div>
                    <div id="settings-preview-bs" class="font-outfit text-slate-400 text-center" style="font-size:1rem">
                        Reci: "On je Allah - Jedan! Allah je Utoƒçi≈°te svakom."</div>
                </div>

                <div class="pt-2">
                    <label class="text-[10px] text-slate-400 uppercase tracking-wider block mb-1">Uƒçaƒç</label>
                    <select id="reciter-select"
                        class="w-full bg-slate-950/50 text-slate-300 rounded-xl p-2.5 text-sm border border-slate-800 outline-none focus:border-emerald-500 transition-colors cursor-pointer appearance-none">
                        <option value="Ahmed_ibn_Ali_al-Ajamy_128kbps_ketaballah.net" class="bg-slate-900">Ahmed el-Ad≈æemi</option>
                        <option value="Hudhaify_128kbps" class="bg-slate-900">Ali el-Huzejfi</option>
                        <option value="Abu_Bakr_Ash-Shaatree_128kbps" class="bg-slate-900">Ebu Bekr E≈°-≈†atri</option>
                        <option value="Yasser_Ad-Dussary_128kbps" class="bg-slate-900">Jasir ed-Devseri</option>
                        <option value="MaherAlMuaiqly128kbps" class="bg-slate-900">Mahir el-Muajkli</option>
                        <option value="Husary_128kbps" class="bg-slate-900">Mahmud Halil el-Husari</option>
                        <option value="Husary_Muallim_128kbps" class="bg-slate-900">Mahmud Halil el-Husari (Uƒçitelj)</option>
                        <option value="Alafasy_128kbps" class="bg-slate-900">Mi≈°ari Ra≈°id el-Afasi</option>
                        <option value="Muhammad_Ayyoub_128kbps" class="bg-slate-900">Muhammed Ejjub</option>
                        <option value="Salah_Al_Budair_128kbps" class="bg-slate-900">Salah el-Budejr</option>
                    </select>
                </div>

                <div class="pt-2">
                    <label class="text-[10px] text-slate-400 uppercase tracking-wider block mb-1"
                        data-i18n="appTheme">Tema aplikacije</label>
                    <select id="theme-select"
                        class="w-full bg-slate-950/50 text-slate-300 rounded-xl p-2.5 text-sm border border-slate-800 outline-none focus:border-emerald-500 transition-colors cursor-pointer appearance-none">
                        <option value="" class="bg-slate-900" data-i18n="themeEmerald">Smaragdna (Standardno)
                        </option>
                        <option value="blue" class="bg-slate-900" data-i18n="themeBlue">Kraljevski plava</option>
                        <option value="amber" class="bg-slate-900" data-i18n="themeAmber">Zlato</option>
                        <option value="rose" class="bg-slate-900" data-i18n="themeRose">Ru≈æa</option>
                        <option value="purple" class="bg-slate-900" data-i18n="themePurple">Ljubiƒçasta</option>
                        <option value="teal" class="bg-slate-900" data-i18n="themeTeal">Tirkizna</option>
                    </select>
                </div>

                <div
                    class="pt-2 flex items-center justify-between bg-slate-950/30 p-3 rounded-xl border border-slate-800 mt-2">
                    <div class="flex flex-col">
                        <span class="text-sm font-bold text-slate-300" data-i18n="lightMode">Svijetli mod</span>
                        <span class="text-[10px] text-slate-500" data-i18n="lightModeDesc">ƒåistiji prikaz za
                            ƒçitanje</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="lightmode-toggle" class="sr-only peer">
                        <div
                            class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500">
                        </div>
                    </label>
                </div>

                <div
                    class="pt-2 flex items-center justify-between bg-slate-950/30 p-3 rounded-xl border border-slate-800 mt-2">
                    <div class="flex flex-col">
                        <span class="text-sm font-bold text-slate-300" data-i18n="autoPlayNext">Automatski
                            sljedeƒái</span>
                        <span class="text-[10px] text-slate-500" data-i18n="autoPlayDesc">Nastavi kad audio
                            zavr≈°i</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="autoplay-toggle" class="sr-only peer" checked>
                        <div
                            class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500">
                        </div>
                    </label>
                </div>

                <div
                    class="pt-2 flex items-center justify-between bg-slate-950/30 p-3 rounded-xl border border-slate-800 mt-2">
                    <div class="flex flex-col">
                        <span class="text-sm font-bold text-slate-300" data-i18n="tajweedFormatting">Ted≈ævidska
                            pravila</span>
                        <span class="text-[10px] text-slate-500" data-i18n="tajweedDesc">Pravila uƒçenja u bojama</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="tajweed-toggle" class="sr-only peer" checked>
                        <div
                            class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500">
                        </div>
                    </label>
                </div>

                <div
                    class="pt-2 flex items-center justify-between bg-slate-950/30 p-3 rounded-xl border border-slate-800 mt-2">
                    <div class="flex flex-col">
                        <span class="text-sm font-bold text-slate-300" data-i18n="tajweedLegend">Nazivi ted≈ævidskih pravila</span>
                        <span class="text-[10px] text-slate-500" data-i18n="tajweedLegendDesc">Prika≈æi legendu ispod ajeta</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="tajweed-legend-toggle" class="sr-only peer" checked>
                        <div
                            class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500">
                        </div>
                    </label>
                </div>

                <div
                    class="pt-2 flex items-center justify-between bg-slate-950/30 p-3 rounded-xl border border-slate-800 mt-2">
                    <div class="flex flex-col">
                        <span class="text-sm font-bold text-slate-300" data-i18n="showNotes">Liƒçne bilje≈°ke</span>
                        <span class="text-[10px] text-slate-500" data-i18n="showNotesDesc">Prika≈æi polje za podsjetnike</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="notes-toggle" class="sr-only peer" checked>
                        <div
                            class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500">
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- Data Transfer Section -->
        <div class="border-t border-slate-800 pt-6 mt-auto">
            <h3 class="text-slate-200 font-bold mb-4 flex items-center gap-2">
                <ion-icon name="cloud-download-outline"></ion-icon>
                <span data-i18n="dataTransfer">Backup</span>
            </h3>
            <div class="flex gap-2">
                <button id="export-btn"
                    class="flex-1 flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 text-slate-200 text-sm font-semibold py-2 rounded-lg transition-colors border border-slate-700">
                    <ion-icon name="download-outline"></ion-icon>
                    <span data-i18n="export">Izvezi</span>
                </button>
                <button id="import-btn"
                    class="flex-1 flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 text-slate-200 text-sm font-semibold py-2 rounded-lg transition-colors border border-slate-700">
                    <ion-icon name="cloud-upload-outline"></ion-icon>
                    <span data-i18n="import">Uvezi</span>
                </button>
                <input type="file" id="import-file" class="hidden" accept=".json">
            </div>
        </div>


        </div>
    </aside>

    <!-- ===== Bookmarks Overlay (Mobile) ===== -->
    <div id="bookmarks-overlay"
        class="fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-40 hidden opacity-0 transition-opacity duration-300 md:hidden">
    </div>

    <!-- ===== Hifz Overlay (Mobile) ===== -->
    <div id="hifz-overlay"
        class="fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-40 hidden opacity-0 transition-opacity duration-300 md:hidden">
    </div>

    <!-- ===== Hifz Drawer (Mobile) ===== -->
    <aside id="hifz-drawer"
        class="fixed inset-y-0 right-0 w-4/5 sm:w-80 bg-slate-900 border-l border-slate-800 p-6 flex flex-col shrink-0 overflow-y-auto z-50 transform translate-x-full transition-transform duration-300 shadow-2xl md:hidden">
        
        <div class="flex justify-between items-center mb-6 shrink-0 border-b border-slate-800 pb-4">
            <h2 class="text-lg font-bold text-slate-200 flex items-center gap-2">
                <ion-icon name="repeat-outline"></ion-icon>
                <span>Hifz Mod</span>
            </h2>
            <button id="hifz-close-mobile" class="text-3xl text-slate-400 hover:text-slate-200 transition-colors">
                <ion-icon name="close-outline"></ion-icon>
            </button>
        </div>

        <div class="flex flex-col flex-1 min-h-0">
            <!-- Hifz Mode Toggle -->
            <div class="mb-4 bg-rose-500/5 border border-rose-500/20 rounded-xl p-3 shrink-0">
                <div class="flex items-center justify-between gap-2">
                    <div class="flex flex-col flex-1">
                        <span class="text-sm font-bold text-rose-400 uppercase tracking-wider">Aktiviraj</span>
                        <span id="hifz-range-text-mobile" class="text-[11px] text-slate-500 line-clamp-1">Klikni ajet za opseg</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer shrink-0">
                        <input type="checkbox" id="hifz-toggle-mobile" class="sr-only peer">
                        <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-rose-500"></div>
                    </label>
                </div>
            </div>

            <!-- Grid Legend -->
            <div class="flex flex-wrap gap-3 mb-3 text-[10px] font-medium text-slate-400 px-1 shrink-0">
                <div class="flex items-center gap-1">
                    <div class="w-2.5 h-2.5 bg-emerald-500 rounded-sm"></div>
                    Trenutni ajet
                </div>
                <div class="flex items-center gap-1">
                    <div class="w-2 h-2 bg-rose-400 rounded-full"></div>
                    Hifz mod
                </div>
                <div class="flex items-center gap-1">
                    <div class="w-2 h-2 bg-amber-500 rounded-full"></div>
                    D≈æuz
                </div>
                <div class="flex items-center gap-1">
                    <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                    Stranica
                </div>
            </div>

            <!-- Scrollable Ayah Grid (Mobile) -->
            <div class="flex-1 overflow-y-auto custom-scrollbar bg-slate-950/50 p-3 rounded-xl border border-slate-800/60 min-h-[120px]">
                <div id="ayah-grid-mobile" class="grid grid-cols-5 content-start gap-2">
                    <!-- Ayah cells will be injected here -->
                </div>
            </div>
        </div>

    </aside>

    <!-- ===== Bookmarks Drawer (Mobile) ===== -->
    <aside id="bookmarks-drawer"
        class="fixed inset-y-0 right-0 w-4/5 sm:w-80 bg-slate-900 border-l border-slate-800 p-6 flex flex-col shrink-0 overflow-y-auto z-50 transform translate-x-full transition-transform duration-300 shadow-2xl md:hidden">
        <div class="flex justify-between items-center mb-6 shrink-0 border-b border-slate-800 pb-4">
            <h2 class="text-lg font-bold text-slate-200 flex items-center gap-2">
                <ion-icon name="bookmarks-outline"></ion-icon>
                <span data-i18n="bookmarks">Zapamƒáeno</span>
            </h2>
            <button id="bookmarks-close" class="text-3xl text-slate-400 hover:text-slate-200 transition-colors">
                <ion-icon name="close-outline"></ion-icon>
            </button>
        </div>

        <div id="bookmarks-list-mobile"
            class="flex-1 overflow-y-auto flex flex-col gap-2 pr-2 custom-scrollbar text-sm min-h-[150px]">
            <div class="text-slate-500 italic text-center w-full mt-2 text-xs" data-i18n="noBookmarks">Jo≈° nema
                oznaka</div>
        </div>
    </aside>

    <!-- ===== Search Modal (Mobile) ===== -->
    <div id="search-modal" class="modal-overlay hidden md:hidden">
        <div class="modal-container p-0 h-[80vh] flex flex-col justify-start">
            <div class="modal-header shrink-0 border-b border-slate-800 p-4 relative z-10 bg-slate-900 rounded-t-2xl">
                <div class="flex items-center gap-3 w-full">
                    <button class="text-slate-400 hover:text-emerald-400 transition-colors p-1" data-modal-close="search-modal">
                        <ion-icon name="arrow-back-outline" class="text-2xl"></ion-icon>
                    </button>
                    <div class="relative w-full">
                        <input type="text" id="search-input-modal" data-i18n-placeholder="searchPlaceholder"
                            placeholder="Pretra≈æi tekst ili ajet (2:255)..."
                            class="bg-slate-950 border border-slate-700 text-slate-100 h-[2.5rem] pl-[2.25rem] pr-[1rem] rounded-lg outline-none focus:border-emerald-500 transition-all w-full text-[0.875rem] placeholder:text-slate-600 focus:ring-2 focus:ring-emerald-500/20">
                        <ion-icon name="search-outline"
                            class="absolute left-[0.75rem] top-1/2 -translate-y-1/2 text-slate-500"></ion-icon>
                    </div>
                </div>
            </div>
            <div class="modal-body modal-body-scroll p-0 relative flex-1 bg-slate-900 rounded-b-2xl">
                <div id="search-results-list-modal" class="flex flex-col"></div>
                <div id="search-empty-state-modal" class="p-[1rem] text-center text-[0.875rem] text-slate-500 hidden"
                    data-i18n="noResults">
                    Nema rezultata
                </div>
            </div>
        </div>
    </div>

    <!-- ===== About Modal ===== -->
    <div id="about-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h2 class="modal-title">
                    <ion-icon name="information-circle-outline"></ion-icon>
                    O aplikaciji
                </h2>
                <button class="modal-close" data-modal-close="about-modal">
                    <ion-icon name="close-outline"></ion-icon>
                </button>
            </div>
            <div class="modal-body">
                <div class="about-logo">üìñ</div>
                <h3 class="about-app-name">Mushaf Plus</h3>
                <p class="about-tagline">Interaktivni Mushaf za uƒçenje i preslu≈°avanje Kur'ana</p>

                <div class="about-credits">
                    <div class="about-credit-item">
                        <span class="about-label">Autor</span>
                        <span class="about-value">Edis Aganoviƒá za stranicu <strong>N-UM.com</strong></span>
                    </div>
                    <div class="about-credit-item">
                        <span class="about-label">Saradnik</span>
                        <span class="about-value">Zehrina Buljuba≈°iƒá, prof.</span>
                    </div>
                    <div class="about-credit-item">
                        <span class="about-label">Prevod tumaƒçenja Kur'ana</span>
                        <span class="about-value">Muhammed Mehanoviƒá, prof.</span>
                    </div>
                    <div class="about-credit-item">
                        <span class="about-label">Datum</span>
                        <span class="about-value">26.2.2026.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== Version Modal ===== -->
    <div id="version-modal" class="modal-overlay hidden">
        <div class="modal-container modal-container-lg">
            <div class="modal-header">
                <h2 class="modal-title">
                    <ion-icon name="git-branch-outline"></ion-icon>
                    Verzija i novosti
                </h2>
                <button class="modal-close" data-modal-close="version-modal">
                    <ion-icon name="close-outline"></ion-icon>
                </button>
            </div>
            <div class="modal-body modal-body-scroll">
                <div class="version-badge">v0.0.11</div>

                <!-- v0.0.11 -->
                <div class="changelog-entry">
                    <h4 class="changelog-version">Verzija 0.0.11 <span class="changelog-date">‚Äî 27. februar 2026.</span></h4>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-fixed" style="background-color: #fca5a5; color: #450a0a;">Popravljeno</span>
                        <ul class="changelog-list">
                            <li><strong>Ted≈ævid na mobitelu</strong> ‚Äî Iskljuƒçeno prikazivanje ted≈ævid obja≈°njenja (iskaƒçuƒáih oblaƒçiƒáa) prilikom tapkanja/oznaƒçavanja arapskih rijeƒçi na mobilnim ureƒëajima, kako ne bi ometali fokus na tekst. Na mobitelima se obja≈°njenja sada mogu vidjeti iskljuƒçivo pritiskom na legendu ispod ajeta.</li>
                        </ul>
                    </div>
                </div>

                <!-- v0.0.10 -->
                <div class="changelog-entry">
                    <h4 class="changelog-version">Verzija 0.0.10 <span class="changelog-date">‚Äî 27. februar 2026.</span></h4>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-new">Novo</span>
                        <ul class="changelog-list">
                            <li><strong>Lebdeƒái mobilni meni</strong> ‚Äî Uvedena je nova navigacijska traka na dnu ekrana koja elegantno lebdi iznad sadr≈æaja, omoguƒáavajuƒái brz i jednostavan pristup svim bitnim funkcijama aplikacije na pametnim telefonima.</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-fixed" style="background-color: #fca5a5; color: #450a0a;">Popravljeno</span>
                        <ul class="changelog-list">
                            <li><strong>Problem sa skrolanjem</strong> ‚Äî Rije≈°en problem gdje je prevlaƒçenje prsta za prijelaz na drugi ajet sluƒçajno prekidalo vertikalno skrolanje po cijeloj stranici.</li>
                            <li><strong>Mobilna navigacija</strong> ‚Äî Popravljeno zatvaranje sakrivenih izbornika ("Oznake", "Postavke") kada se ponovo klikne ista ikona na donjoj navigacijskoj traci.</li>
                            <li><strong>Prekrivanje sadr≈æaja</strong> ‚Äî Dodan prostor na dnu ekrana kako bi se sprijeƒçilo da mobilni meni prekriva audio kontrole.</li>
                        </ul>
                    </div>
                </div>

                <!-- v0.0.9 -->
                <div class="changelog-entry">
                    <h4 class="changelog-version">Verzija 0.0.9 <span class="changelog-date">‚Äî 26. februar 2026.</span></h4>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-new">Novo</span>
                        <ul class="changelog-list">
                            <li><strong>Instalacija (PWA)</strong> ‚Äî Dodata moguƒánost instalacije aplikacije na poƒçetni ekran ili raƒçunar, zajedno sa automatskim radom bez interneta nakon prvog uƒçitavanja.</li>
                            <li><strong>Ted≈ævid obja≈°njenja</strong> ‚Äî Sada klikom na naziv ted≈ævidskog pravila ispod ajeta mo≈æete proƒçitati detaljno obja≈°njenje za to pravilo.</li>
                            <li><strong>Postavke bilje≈°ki</strong> ‚Äî Dodana moguƒánost sakrivanja polja za liƒçne bilje≈°ke za ƒçi≈°ƒái interfejs.</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-fixed">Popravljeno</span>
                        <ul class="changelog-list">
                            <li><strong>Naziv uƒçaƒça</strong> ‚Äî Sinhronizovan prikaz imena odabranog uƒçaƒça odmah pri pokretanju aplikacije.</li>
                        </ul>
                    </div>
                </div>

                <!-- v0.0.8 -->
                <div class="changelog-entry">
                    <h4 class="changelog-version">Verzija 0.0.8 <span class="changelog-date">‚Äî 26. februar 2026.</span></h4>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-fixed" style="background-color: #fca5a5; color: #450a0a;">Popravljeno</span>
                        <ul class="changelog-list">
                            <li><strong>Firefox Renderovanje</strong> ‚Äî Rije≈°en problem odsijecanja arapskih znakova (Yaa itd.) u pregledniku Firefox.</li>
                            <li><strong>Ted≈ævid boje</strong> ‚Äî Implementiran CSS Highlight API za savr≈°eno i netaknuto ligaturno spajanje slova (shaping).</li>
                        </ul>
                    </div>
                </div>

                <!-- v0.0.7 -->
                <div class="changelog-entry">
                    <h4 class="changelog-version">Verzija 0.0.7 <span class="changelog-date">‚Äî 25. februar 2026.</span></h4>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-improved">Pobolj≈°ano</span>
                        <ul class="changelog-list">
                            <li><strong>Ted≈ævid pravila</strong> ‚Äî Smanjen i prilagoƒëen izgled oblaƒçiƒáa sa obja≈°njenjem ted≈ævid pravila tako da bude manji i uredniji.</li>
                            <li><strong>Sistem verzionisanja</strong> ‚Äî Optimizovan naƒçin postavljanja verzije za lak≈°e i automatsko a≈æuriranje.</li>
                        </ul>
                    </div>
                </div>

                <!-- v0.0.6 -->
                <div class="changelog-entry">
                    <h4 class="changelog-version">Verzija 0.0.6 <span class="changelog-date">‚Äî 25. februar 2026.</span></h4>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-new">Novo</span>
                        <ul class="changelog-list">
                            <li>Aplikacija sada <strong>pamti posljednji ajet</strong> koji si ƒçitao/la. Kad ponovo otvori≈° stranicu, nastavi≈° taƒçno odakle si stao/la.</li>
                            <li><strong>O aplikaciji</strong> ‚Äî novi dugme u postavkama s informacijama o autoru, saradnicima i prevodu tumaƒçenja.</li>
                            <li><strong>Verzija i novosti</strong> ‚Äî pregled svih promjena i novih funkcija kroz verzije, na jednom mjestu.</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-improved">Pobolj≈°ano</span>
                        <ul class="changelog-list">
                            <li><strong>Nazivi sura</strong> ‚Äî ispravljeni bosanski prevodi za 37 sura prema ispravnoj islamskoj terminologiji.</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-fixed">Ispravljeno</span>
                        <ul class="changelog-list">
                            <li>Rije≈°en problem s prikazom arapskih slova ‚Äî slovo <strong>YAA</strong> s te≈°didom se ispravno prikazuje.</li>
                        </ul>
                    </div>
                </div>

                <!-- v0.0.5 -->
                <div class="changelog-entry">
                    <h4 class="changelog-version">Verzija 0.0.5 <span class="changelog-date">‚Äî 24. februar 2026.</span></h4>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-new">Novo</span>
                        <ul class="changelog-list">
                            <li><strong>Br≈æe uƒçitavanje zvuka</strong> ‚Äî zvuk za sljedeƒái ajet se uƒçitava unaprijed u pozadini, tako da nema ƒçekanja.</li>
                            <li><strong>Br≈æa pretraga</strong> ‚Äî pretraga sada radi u pozadini i ne usporava aplikaciju.</li>
                            <li><strong>Direktan skok na ajet</strong> ‚Äî samo klikni na broj ajeta i upi≈°i ≈æeljeni broj.</li>
                            <li><strong>Pametni fokus</strong> ‚Äî kad klikne≈° na polje za d≈æuz, stranicu ili ajet, polje se automatski oƒçisti za lak≈°e kucanje.</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-improved">Pobolj≈°ano</span>
                        <ul class="changelog-list">
                            <li>Navigacijske bed≈æeve (Ajet, D≈æuz, Str.) smo redizajnirali za ljep≈°i i profesionalniji izgled.</li>
                            <li>Aplikacija je sada znatno br≈æa pri navigaciji i oznaƒçavanju ajeta.</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-fixed">Ispravljeno</span>
                        <ul class="changelog-list">
                            <li>Ispravljen prikaz ted≈ævidskih pravila ‚Äî arapska slova se vi≈°e ne razdvajaju.</li>
                            <li>Rije≈°en problem s ke≈°om u Firefoxu ‚Äî nove promjene se sada ispravno uƒçitavaju.</li>
                        </ul>
                    </div>
                </div>

                <!-- v0.0.4 -->
                <div class="changelog-entry">
                    <h4 class="changelog-version">Verzija 0.0.4 <span class="changelog-date">‚Äî 24. februar 2026.</span></h4>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-new">Novo</span>
                        <ul class="changelog-list">
                            <li><strong>Navigacija po d≈æuzu i stranici</strong> ‚Äî upi≈°i broj d≈æuza (1-30) ili stranice (1-604) i skoƒçi direktno.</li>
                            <li><strong>Hifz mod</strong> ‚Äî izaberi opseg ajeta i ponavljaj ih u krug, idealno za uƒçenje napamet.</li>
                            <li><strong>Poznati uƒçaƒçi</strong> ‚Äî slu≈°aj recitacije od Mishary Alafasyja, As-Sudaisa, Al-Husaryja i drugih.</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-improved">Pobolj≈°ano</span>
                        <ul class="changelog-list">
                            <li>Praƒáenje progresa sada prikazuje taƒçan broj prouƒçenih ajeta.</li>
                            <li>Potpuno redizajnirana mre≈æa ajeta u boƒçnom meniju.</li>
                        </ul>
                    </div>
                </div>

                <!-- v0.0.3 -->
                <div class="changelog-entry">
                    <h4 class="changelog-version">Verzija 0.0.3 <span class="changelog-date">‚Äî 24. februar 2026.</span></h4>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-new">Novo</span>
                        <ul class="changelog-list">
                            <li><strong>Bed≈æevi za d≈æuz i stranicu</strong> ‚Äî odmah vidi≈° u kojem si d≈æuzu i na kojoj stranici Medina Mushafa.</li>
                            <li><strong>Legenda ted≈ævidskih pravila</strong> ‚Äî ispod ajeta se prikazuju boje i nazivi pravila koja su prisutna u tom ajetu.</li>
                        </ul>
                    </div>
                </div>

                <!-- v0.0.2 -->
                <div class="changelog-entry">
                    <h4 class="changelog-version">Verzija 0.0.2 <span class="changelog-date">‚Äî 24. februar 2026.</span></h4>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-new">Novo</span>
                        <ul class="changelog-list">
                            <li><strong>Oznaƒçavanje u pretrazi</strong> ‚Äî pronaƒëeni tekst je sada istaknut zelenom bojom u rezultatima.</li>
                            <li><strong>Vodiƒç za swipe</strong> ‚Äî pri prvom kori≈°tenju, pojavi se krtaka poruka koja obja≈°njava swipe lijevo/desno za navigaciju.</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <span class="changelog-tag tag-improved">Pobolj≈°ano</span>
                        <ul class="changelog-list">
                            <li>Pametniji redoslijed rezultata pretrage ‚Äî taƒçna podudaranja se prikazuju prva.</li>
                        </ul>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- ===== Surah & Hifz Modal ===== -->
    <div id="surah-hifz-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h2 class="modal-title">
                    <ion-icon name="book-outline"></ion-icon>
                    Sura
                </h2>
                <button class="modal-close" data-modal-close="surah-hifz-modal">
                    <ion-icon name="close-outline"></ion-icon>
                </button>
            </div>
            <div class="modal-body modal-body-scroll space-y-4">
                
                <!-- Hifz Mode has been moved to Mobile Drawer -->                <!-- Surah List -->
                <div>
                    <h3 class="text-slate-200 font-bold mb-2 text-sm uppercase tracking-wider">Izaberi suru</h3>
                    <div id="modal-surah-list" class="flex flex-col gap-1 max-h-[50vh] overflow-y-auto custom-scrollbar pr-1">
                        <!-- Populated by JS -->
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav id="mobile-bottom-nav" class="fixed bottom-0 left-0 w-full bg-slate-900/95 backdrop-blur-md border-t border-slate-800 flex justify-around items-center p-2 pb-[env(safe-area-inset-bottom,0.5rem)] z-[60] transition-transform duration-300">
        <button id="nav-surah-btn" class="flex flex-col items-center justify-center p-2 text-slate-400 hover:text-emerald-400 transition-colors w-16">
            <ion-icon name="book-outline" class="text-2xl mb-1"></ion-icon>
            <span class="text-[10px] font-medium" data-i18n="surah">Sura</span>
        </button>
        <button id="nav-hifz-btn" class="flex flex-col items-center justify-center p-2 text-slate-400 hover:text-rose-400 transition-colors w-16">
            <ion-icon name="repeat-outline" class="text-2xl mb-1"></ion-icon>
            <span class="text-[10px] font-medium" data-i18n="hifz">Hifz</span>
        </button>
        <button id="nav-search-btn" class="flex flex-col items-center justify-center p-2 text-slate-400 hover:text-emerald-400 transition-colors w-16">
            <ion-icon name="search-outline" class="text-2xl mb-1"></ion-icon>
            <span class="text-[10px] font-medium" data-i18n="search">Tra≈æi</span>
        </button>
        <button id="nav-bookmarks-btn" class="flex flex-col items-center justify-center p-2 text-slate-400 hover:text-emerald-400 transition-colors w-16">
            <ion-icon name="bookmark-outline" class="text-2xl mb-1"></ion-icon>
            <span class="text-[10px] font-medium" data-i18n="bookmarks">Oznake</span>
        </button>
        <button id="nav-settings-btn" class="flex flex-col items-center justify-center p-2 text-slate-400 hover:text-emerald-400 transition-colors w-16">
            <ion-icon name="options-outline" class="text-2xl mb-1"></ion-icon>
            <span class="text-[10px] font-medium" data-i18n="preferences">Postavke</span>
        </button>
    </nav>

    <!-- Hidden audio element for playback -->
    <audio id="audio-playback" class="hidden"></audio>

    <!-- Swipe UX: First-time Toast -->
    <div id="swipe-toast" class="swipe-toast">
        <div class="toast-direction">
            <ion-icon name="arrow-back-outline"></ion-icon>
            <span>Prethodni ajet</span>
        </div>
        <div class="toast-divider"></div>
        <div class="toast-direction">
            <span>Slijedeƒái ajet</span>
            <ion-icon name="arrow-forward-outline"></ion-icon>
        </div>
    </div>

    <!-- App Scripts (Dynamic versioning) -->
    <script>
        const scriptsToLoad = [
            "data/quran_data.js",
            "js/tajweed.js",
            "js/i18n.js",
            "js/config.js",
            "js/utils.js",
            "js/effects.js",
            "js/audio.js",
            "js/render.js",
            "js/actions.js",
            "js/quranMeta.js",
            "js/app.js"
        ];
        
        scriptsToLoad.forEach(src => {
            document.write(`<script src="${src}?v=${APP_VERSION}"><\/script>`);
        });

        // Ensure the version UI displays stay updated automatically
        document.addEventListener('DOMContentLoaded', () => {
            const badge = document.querySelector('.version-badge');
            if (badge) badge.textContent = `v${APP_VERSION}`;
            
            // Also update the active title in the changelog snippet
            const title = document.querySelector('.changelog-version');
            if (title && title.innerHTML.includes('Verzija')) {
                const dateSpan = title.querySelector('.changelog-date');
                if (dateSpan) {
                    title.innerHTML = `Verzija ${APP_VERSION} ` + dateSpan.outerHTML;
                }
            }
        });

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                let refreshing = false;
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    if (!refreshing) {
                        refreshing = true;
                        window.location.reload();
                    }
                });

                navigator.serviceWorker.register('./service-worker.js')
                    .then((registration) => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);

                        // If there's a waiting worker, an update is ready
                        if (registration.waiting) {
                            showUpdateToast(registration.waiting);
                        }

                        // Listen for new worker installation
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                // Has installed and isn't the active controller yet
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdateToast(newWorker);
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });

            function showUpdateToast(worker) {
                // Remove existing if any
                const existing = document.getElementById('pwa-update-toast');
                if (existing) existing.remove();

                const toast = document.createElement('div');
                toast.id = 'pwa-update-toast';
                // Inline styles for slide-up animation without an external class
                toast.style.cssText = `
                    position: fixed; bottom: 5rem; left: 50%; width: 90%; max-width: 320px;
                    transform: translateX(-50%) translateY(20px); opacity: 0;
                    background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(8px);
                    border: 1px solid rgba(16, 185, 129, 0.4); border-radius: 12px;
                    padding: 12px 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.5);
                    display: flex; align-items: center; justify-content: space-between; gap: 12px;
                    z-index: 9999;
                    animation: slideUpFade 0.4s ease-out forwards;
                `;
                
                // Add keyframes to document once
                if (!document.getElementById('pwa-anim-style')) {
                    const style = document.createElement('style');
                    style.id = 'pwa-anim-style';
                    style.innerHTML = `@keyframes slideUpFade { to { transform: translateX(-50%) translateY(0); opacity: 1; } }`;
                    document.head.appendChild(style);
                }

                toast.innerHTML = `
                    <div style="display:flex; flex-direction:column; gap:2px; flex:1;">
                        <span style="font-weight:700; font-size:14px; color:#f1f5f9;">Nova verzija je spremna</span>
                        <span style="font-size:11px; color:#94a3b8;">Osvje≈æi aplikaciju za preuzimanje.</span>
                    </div>
                    <button id="pwa-update-btn" style="background:#059669; color:#fff; font-size:12px; font-weight:700; padding:6px 12px; border-radius:6px; cursor:pointer;" class="active:scale-95 transition-transform">
                        Osvje≈æi
                    </button>
                    <button id="pwa-close-btn" style="color:#94a3b8; font-size:20px; border:none; background:none; cursor:pointer; padding:4px; display:flex;">
                        <ion-icon name="close-outline"></ion-icon>
                    </button>
                `;

                document.body.appendChild(toast);

                document.getElementById('pwa-update-btn').addEventListener('click', () => {
                    if (worker && typeof worker.postMessage === 'function') {
                        worker.postMessage('SKIP_WAITING');
                    }
                    // Force a reload as a fallback case if controllerchange doesn't automatically fire
                    setTimeout(() => {
                        window.location.reload(true);
                    }, 300);
                });

                document.getElementById('pwa-close-btn').addEventListener('click', () => {
                    toast.remove();
                });
            }
        }
    </script>
</body>

</html>
